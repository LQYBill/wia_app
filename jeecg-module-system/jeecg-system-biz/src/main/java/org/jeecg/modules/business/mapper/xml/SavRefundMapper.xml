<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.business.mapper.SavRefundMapper">
    <select id="fetchRefundAmount" resultType="java.math.BigDecimal">
        SELECT total_refund_amount
        FROM sav_refund s
        WHERE s.invoice_number = #{invoiceNumber}
    </select>
    <update id="cancelInvoice">
        UPDATE sav_refund
            JOIN platform_order po ON sav_refund.platform_order_id = po.id
            JOIN shop s ON po.shop_id = s.id
            JOIN client c ON s.owner_id = c.id
        SET invoice_number      = NULL,
            refund_date         = NULL,
            total_refund_amount = 0.0
        WHERE invoice_number = #{invoiceNumber}
            AND c.id = #{clientId};
    </update>
    <update id="cancelBatchInvoice">
        UPDATE sav_refund
        SET invoice_number      = NULL,
            refund_date         = NULL,
            total_refund_amount = 0.0
        WHERE invoice_number IN
        <foreach collection="invoiceNumbers" separator="," open="(" close=")" index="index" item="invoiceNumber">
            #{invoiceNumber}
        </foreach>;
    </update>
</mapper>